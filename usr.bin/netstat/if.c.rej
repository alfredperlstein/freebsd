@@ -566,10 +647,8 @@
 		return;
 	firstifnet = (u_long)TAILQ_FIRST(&ifnethead);
 
-	if ((iftot = malloc(sizeof(struct iftot))) == NULL) {
-		printf("malloc failed\n");
-		exit(1);
-	}
+	if ((iftot = malloc(sizeof(struct iftot))) == NULL)
+		xo_errx(1, "malloc failed\n");
 	memset(iftot, 0, sizeof(struct iftot));
 
 	interesting = NULL;
@@ -585,26 +664,20 @@
 			interesting_off = off;
 		}
 		snprintf(ip->ift_name, sizeof(ip->ift_name), "(%s)", name);
-		if ((ipn = malloc(sizeof(struct iftot))) == NULL) {
-			printf("malloc failed\n");
-			exit(1);
-		}
+		if ((ipn = malloc(sizeof(struct iftot))) == NULL)
+			xo_errx(1, "malloc failed");
 		memset(ipn, 0, sizeof(struct iftot));
 		SLIST_NEXT(ip, chain) = ipn;
 		ip = ipn;
 		off = (u_long)TAILQ_NEXT(&ifnet, if_link);
 	}
 	if (interface && interesting == NULL)
-		errx(1, "%s: unknown interface", interface);
-	if ((total = malloc(sizeof(struct iftot))) == NULL) {
-		printf("malloc failed\n");
-		exit(1);
-	}
+		xo_errx(1, "%s: unknown interface", interface);
+	if ((total = malloc(sizeof(struct iftot))) == NULL)
+		xo_errx(1, "malloc failed");
 	memset(total, 0, sizeof(struct iftot));
-	if ((sum = malloc(sizeof(struct iftot))) == NULL) {
-		printf("malloc failed\n");
-		exit(1);
-	}
+	if ((sum = malloc(sizeof(struct iftot))) == NULL)
+		xo_errx(1, "malloc failed\n");
 	memset(sum, 0, sizeof(struct iftot));
 
 	(void)signal(SIGALRM, catchalarm);
@@ -614,37 +687,45 @@
 	interval_it.it_value = interval_it.it_interval;
 	setitimer(ITIMER_REAL, &interval_it, NULL);
 	first = 1;
+	xo_open_list("interface-statistics");
 banner:
-	printf("%17s %14s %16s", "input",
+	xo_emit("{T:/%17s} {T:/%14s} {T:/%16s}\n", "input",
 	    interesting ? interesting->ift_name : "(Total)", "output");
-	putchar('\n');
-	printf("%10s %5s %5s %10s %10s %5s %10s %5s",
+	xo_emit("{T:/%10s} {T:/%5s} {T:/%5s} {T:/%10s} {T:/%10s} "
+		"{T:/%5s} {T:/%10s} {T:/%5s}",
 	    "packets", "errs", "idrops", "bytes", "packets", "errs", "bytes",
 	    "colls");
 	if (dflag)
-		printf(" %5.5s", "drops");
-	putchar('\n');
-	fflush(stdout);
+		xo_emit(" {T:/%5.5s}", "drops");
+	xo_emit("\n");
+	xo_flush();
 	line = 0;
 loop:
+	if (!first)
+		xo_open_instance("interface-statistics");
 	if (interesting != NULL) {
 		ip = interesting;
-		if (kread(interesting_off, (char *)&ifnet, sizeof ifnet) != 0) {
-			printf("???\n");
-			exit(1);
-		};
+		if (kread(interesting_off, (char *)&ifnet, sizeof ifnet) != 0)
+			xo_errx(1, "???");
 		if (!first) {
-			show_stat("lu", 10, ifnet.if_ipackets - ip->ift_ip, 1);
-			show_stat("lu", 5, ifnet.if_ierrors - ip->ift_ie, 1);
-			show_stat("lu", 5, ifnet.if_iqdrops - ip->ift_id, 1);
-			show_stat("lu", 10, ifnet.if_ibytes - ip->ift_ib, 1);
-			show_stat("lu", 10, ifnet.if_opackets - ip->ift_op, 1);
-			show_stat("lu", 5, ifnet.if_oerrors - ip->ift_oe, 1);
-			show_stat("lu", 10, ifnet.if_obytes - ip->ift_ob, 1);
-			show_stat("NRSlu", 5,
+			show_stat("lu", 10, "received-packets",
+				  ifnet.if_ipackets - ip->ift_ip, 1);
+			show_stat("lu", 5, "received-errors",
+				  ifnet.if_ierrors - ip->ift_ie, 1);
+			show_stat("lu", 5, "dropped-packets",
+				  ifnet.if_iqdrops - ip->ift_id, 1);
+			show_stat("lu", 10, "received-bytes",
+				  ifnet.if_ibytes - ip->ift_ib, 1);
+			show_stat("lu", 10, "sent-packets",
+				  ifnet.if_opackets - ip->ift_op, 1);
+			show_stat("lu", 5, "send-errors",
+				  ifnet.if_oerrors - ip->ift_oe, 1);
+			show_stat("lu", 10, "sent-bytes",
+				  ifnet.if_obytes - ip->ift_ob, 1);
+			show_stat("NRSlu", 5, "collisions",
 			    ifnet.if_collisions - ip->ift_co, 1);
 			if (dflag)
-				show_stat("LSu", 5,
+				show_stat("LSu", 5, "dropped-packets",
 				    ifnet.if_snd.ifq_drops - ip->ift_dr, 1);
 		}
 		ip->ift_ip = ifnet.if_ipackets;
@@ -685,25 +766,37 @@
 			off = (u_long)TAILQ_NEXT(&ifnet, if_link);
 		}
 		if (!first) {
-			show_stat("lu", 10, sum->ift_ip - total->ift_ip, 1);
-			show_stat("lu", 5, sum->ift_ie - total->ift_ie, 1);
-			show_stat("lu", 5, sum->ift_id - total->ift_id, 1);
-			show_stat("lu", 10, sum->ift_ib - total->ift_ib, 1);
-			show_stat("lu", 10, sum->ift_op - total->ift_op, 1);
-			show_stat("lu", 5, sum->ift_oe - total->ift_oe, 1);
-			show_stat("lu", 10, sum->ift_ob - total->ift_ob, 1);
-			show_stat("NRSlu", 5, sum->ift_co - total->ift_co, 1);
+			show_stat("lu", 10, "received-packets",
+				  sum->ift_ip - total->ift_ip, 1);
+			show_stat("lu", 5, "received-errors",
+				  sum->ift_ie - total->ift_ie, 1);
+			show_stat("lu", 5, "dropped-packets",
+				  sum->ift_id - total->ift_id, 1);
+			show_stat("lu", 10, "received-bytes",
+				  sum->ift_ib - total->ift_ib, 1);
+			show_stat("lu", 10, "sent-packets",
+				  sum->ift_op - total->ift_op, 1);
+			show_stat("lu", 5, "send-errors",
+				  sum->ift_oe - total->ift_oe, 1);
+			show_stat("lu", 10, "sent-bytes",
+				  sum->ift_ob - total->ift_ob, 1);
+			show_stat("NRSlu", 5, "collisions",
+				  sum->ift_co - total->ift_co, 1);
 			if (dflag)
-				show_stat("LSu", 5,
-				    sum->ift_dr - total->ift_dr, 1);
+				show_stat("LSu", 5, "dropped-packets",
+					  sum->ift_dr - total->ift_dr, 1);
 		}
 		*total = *sum;
 	}
-	if (!first)
-		putchar('\n');
-	fflush(stdout);
-	if ((noutputs != 0) && (--noutputs == 0))
+	if (!first) {
+		xo_emit("\n");
+		xo_close_instance("interface-statistics");
+	}
+	xo_flush();
+	if ((noutputs != 0) && (--noutputs == 0)) {
+		xo_close_list("interface-statistics");
 		exit(0);
+	}
 	oldmask = sigblock(sigmask(SIGALRM));
 	while (!signalled)
 		sigpause(0);
